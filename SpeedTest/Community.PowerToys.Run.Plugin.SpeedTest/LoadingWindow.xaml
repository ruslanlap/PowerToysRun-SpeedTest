<Window
    x:Class="Community.PowerToys.Run.Plugin.SpeedTest.LoadingWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Speed Test in Progress"
    Height="580"
    Width="580"
    ResizeMode="NoResize"
    WindowStartupLocation="CenterScreen"
    Background="#0F1117"
    Foreground="White"
    FontFamily="Segoe UI">

    <Window.Resources>
        <!-- Professional Color Palette -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="#24273a" />
        <SolidColorBrush x:Key="CardBrush" Color="#1A1D28" />
        <SolidColorBrush x:Key="TextBrush" Color="#E4E6F0" />
        <SolidColorBrush x:Key="HyperlinkBrush" Color="#4DABF7" />
        <SolidColorBrush x:Key="AccentBrush" Color="#4DABF7" />
        <SolidColorBrush x:Key="SuccessBrush" Color="#40C057" />
        <SolidColorBrush x:Key="WarningBrush" Color="#FAB005" />
        <SolidColorBrush x:Key="ErrorBrush" Color="#FA5252" />

        <!-- Single Circle Animation -->
        <Storyboard x:Key="SpinnerAnimation" RepeatBehavior="Forever">
            <!-- Single circle rotation -->
            <DoubleAnimation
                Storyboard.TargetName="SpinnerRotation"
                Storyboard.TargetProperty="Angle"
                From="0"
                To="360"
                Duration="0:0:2" />

            <!-- GO text pulse animation -->
            <DoubleAnimation
                Storyboard.TargetName="GoTextScale"
                Storyboard.TargetProperty="ScaleX"
                From="1"
                To="1.05"
                Duration="0:0:1.5"
                AutoReverse="True"
                RepeatBehavior="Forever" />
            <DoubleAnimation
                Storyboard.TargetName="GoTextScale"
                Storyboard.TargetProperty="ScaleY"
                From="1"
                To="1.05"
                Duration="0:0:1.5"
                AutoReverse="True"
                RepeatBehavior="Forever" />
        </Storyboard>

        <!-- Step indicator styles -->
        <Style x:Key="StepIndicator" TargetType="Ellipse">
            <Setter Property="Width" Value="8"/>
            <Setter Property="Height" Value="8"/>
            <Setter Property="Margin" Value="6,0"/>
            <Setter Property="Fill" Value="#2C2E3B"/>
            <Setter Property="Stroke" Value="#3D3F4E"/>
            <Setter Property="StrokeThickness" Value="1"/>
        </Style>

        <Style x:Key="ActiveStepIndicator" TargetType="Ellipse" BasedOn="{StaticResource StepIndicator}">
            <Setter Property="Fill" Value="#4DABF7"/>
            <Setter Property="Stroke" Value="#339AF0"/>
        </Style>

        <Style x:Key="CompletedStepIndicator" TargetType="Ellipse" BasedOn="{StaticResource StepIndicator}">
            <Setter Property="Fill" Value="#40C057"/>
            <Setter Property="Stroke" Value="#37B24D"/>
        </Style>

        <Style x:Key="ErrorStepIndicator" TargetType="Ellipse" BasedOn="{StaticResource StepIndicator}">
            <Setter Property="Fill" Value="#FA5252"/>
            <Setter Property="Stroke" Value="#F03E3E"/>
        </Style>
    </Window.Resources>

    <!-- Auto-start animation on window load -->
    <Window.Triggers>
        <EventTrigger RoutedEvent="FrameworkElement.Loaded">
            <BeginStoryboard Storyboard="{StaticResource SpinnerAnimation}"/>
        </EventTrigger>
    </Window.Triggers>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0"
                   Text="Running Speed Test"
                   FontSize="28"
                   FontWeight="SemiBold"
                   HorizontalAlignment="Center"
                   Foreground="{StaticResource TextBrush}"
                   Margin="0,0,0,24"/>

        <!-- Simple Central GO button with single circle -->
        <Grid Grid.Row="1" HorizontalAlignment="Center" Margin="0,0,0,20">
            <!-- Dark background circle -->
            <Ellipse Width="200" Height="200" Fill="#1A1D28" Stroke="#2C2E3B" StrokeThickness="2"/>

            <!-- Single spinning circle -->
            <Canvas Width="200" Height="200">
                <Grid>
                    <Grid.RenderTransform>
                        <RotateTransform x:Name="SpinnerRotation" CenterX="100" CenterY="100"/>
                    </Grid.RenderTransform>
                    <Ellipse Width="200"
                             Height="200"
                             Stroke="#4DABF7"
                             StrokeThickness="4"
                             StrokeDashArray="150 100"
                             Fill="Transparent">
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#4DABF7" Opacity="0.6"/>
                        </Ellipse.Effect>
                    </Ellipse>
                </Grid>
            </Canvas>

            <!-- GO text -->
            <TextBlock Text="GO"
                       FontSize="48"
                       FontWeight="Bold"
                       Foreground="{StaticResource TextBrush}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center">
                <TextBlock.Effect>
                    <DropShadowEffect BlurRadius="6" ShadowDepth="0" Color="#4DABF7" Opacity="0.5"/>
                </TextBlock.Effect>
                <TextBlock.RenderTransform>
                    <ScaleTransform x:Name="GoTextScale" CenterX="24" CenterY="24"/>
                </TextBlock.RenderTransform>
            </TextBlock>

            <!-- Current speed text -->
            <TextBlock x:Name="CurrentSpeedText"
                       Text=""
                       FontSize="14"
                       Foreground="{StaticResource TextBrush}"
                       Opacity="0.9"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Bottom"
                       Margin="0,0,0,20">
                <TextBlock.Effect>
                    <DropShadowEffect BlurRadius="3" ShadowDepth="0" Color="#4DABF7" Opacity="0.5"/>
                </TextBlock.Effect>
            </TextBlock>
        </Grid>

        <!-- Step indicators -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,20">
            <Ellipse x:Name="Step1Indicator" Style="{StaticResource StepIndicator}"/>
            <Ellipse x:Name="Step2Indicator" Style="{StaticResource StepIndicator}"/>
            <Ellipse x:Name="Step3Indicator" Style="{StaticResource StepIndicator}"/>
            <Ellipse x:Name="Step4Indicator" Style="{StaticResource StepIndicator}"/>
        </StackPanel>

        <!-- CLI Output Box -->
        <Border Grid.Row="3"
                BorderBrush="#2C2E3B"
                BorderThickness="1"
                CornerRadius="8"
                Margin="0,0,0,20"
                Background="#1A1D28">
            <Border.Effect>
                <DropShadowEffect BlurRadius="12" ShadowDepth="0" Color="Black" Opacity="0.2"/>
            </Border.Effect>
            <ScrollViewer x:Name="OutputScrollViewer"
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Auto"
                         Padding="12">
                <TextBlock x:Name="CLIOutputText"
                           TextWrapping="NoWrap"
                           FontFamily="Consolas"
                           FontSize="12"
                           Foreground="#40C057"
                           Margin="0"/>
            </ScrollViewer>
        </Border>

        <!-- Status and details -->
        <StackPanel Grid.Row="4" Margin="0,0,0,0">
            <!-- Status -->
            <TextBlock x:Name="StatusText"
                       Text="Connecting to server..."
                       HorizontalAlignment="Center"
                       FontSize="16"
                       FontWeight="Medium"
                       Foreground="{StaticResource TextBrush}"
                       Margin="0,0,0,6">
                <TextBlock.Effect>
                    <DropShadowEffect BlurRadius="4" ShadowDepth="0" Color="#4DABF7" Opacity="0.4"/>
                </TextBlock.Effect>
            </TextBlock>

            <!-- Detail text / Latency -->
            <TextBlock x:Name="DetailText"
                       Text="Initializing speed test..."
                       HorizontalAlignment="Center"
                       FontSize="14"
                       Foreground="#4DABF7"
                       Opacity="0.9"
                       Margin="0,0,0,0"/>

            <TextBlock x:Name="ServerNameText"
                       Text=""
                       HorizontalAlignment="Center"
                       FontSize="12"
                       Foreground="#40C057"
                       Margin="0,6,0,0"/>
        </StackPanel>
    </Grid>
</Window>