<Window
    x:Class="Community.PowerToys.Run.Plugin.SpeedTest.LoadingWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Speed Test in Progress"
    Height="720"
    Width="680"
    ResizeMode="NoResize"
    WindowStartupLocation="CenterScreen"
    Background="Transparent"
    AllowsTransparency="True"
    WindowStyle="None"
    Foreground="White"
    FontFamily="Segoe UI Variable Display">

    <Window.Resources>
        <!-- Modern Color Palette with Glassmorphism -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="#1A1B23" />
        <SolidColorBrush x:Key="CardBrush" Color="#252631" />
        <SolidColorBrush x:Key="GlassBrush" Color="#33FFFFFF" />
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#FFFFFF" />
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#B8BCC8" />
        <SolidColorBrush x:Key="AccentBrush" Color="#00D4FF" />
        <SolidColorBrush x:Key="AccentGradientBrush" Color="#6366F1" />
        <SolidColorBrush x:Key="SuccessBrush" Color="#10B981" />
        <SolidColorBrush x:Key="WarningBrush" Color="#F59E0B" />
        <SolidColorBrush x:Key="ErrorBrush" Color="#EF4444" />

        <!-- Gradients -->
        <LinearGradientBrush x:Key="PrimaryGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#6366F1" Offset="0"/>
            <GradientStop Color="#00D4FF" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="BackgroundGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#1A1B23" Offset="0"/>
            <GradientStop Color="#252631" Offset="1"/>
        </LinearGradientBrush>

        <!-- Step Progress Animation -->
        <Storyboard x:Key="StepCompleteAnimation">
            <DoubleAnimation
                Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                From="1"
                To="1.2"
                Duration="0:0:0.2"
                AutoReverse="True" />
            <DoubleAnimation
                Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                From="1"
                To="1.2"
                Duration="0:0:0.2"
                AutoReverse="True" />
        </Storyboard>

        <!-- Step indicator styles with modern design -->
        <Style x:Key="StepIndicator" TargetType="Border">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="Margin" Value="8,0"/>
            <Setter Property="Background" Value="#2A2B35"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="BorderBrush" Value="#3A3B45"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform/>
                </Setter.Value>
            </Setter>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
        </Style>

        <Style x:Key="ActiveStepIndicator" TargetType="Border" BasedOn="{StaticResource StepIndicator}">
            <Setter Property="Background" Value="{StaticResource PrimaryGradient}"/>
            <Setter Property="BorderBrush" Value="#00D4FF"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#00D4FF" Opacity="0.6"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CompletedStepIndicator" TargetType="Border" BasedOn="{StaticResource StepIndicator}">
            <Setter Property="Background" Value="#10B981"/>
            <Setter Property="BorderBrush" Value="#059669"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="6" ShadowDepth="0" Color="#10B981" Opacity="0.4"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ErrorStepIndicator" TargetType="Border" BasedOn="{StaticResource StepIndicator}">
            <Setter Property="Background" Value="#EF4444"/>
            <Setter Property="BorderBrush" Value="#DC2626"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="6" ShadowDepth="0" Color="#EF4444" Opacity="0.4"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Storyboard для анімації крапок -->
        <Storyboard x:Key="DotsAnimation" RepeatBehavior="Forever">
            <!-- Анімація для кожної крапки з різними BeginTime -->
            <DoubleAnimation Storyboard.TargetName="Dot1" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0"/>
            <DoubleAnimation Storyboard.TargetName="Dot2" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.08"/>
            <DoubleAnimation Storyboard.TargetName="Dot3" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.16"/>
            <DoubleAnimation Storyboard.TargetName="Dot4" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.24"/>
            <DoubleAnimation Storyboard.TargetName="Dot5" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.32"/>
            <DoubleAnimation Storyboard.TargetName="Dot6" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.40"/>
            <DoubleAnimation Storyboard.TargetName="Dot7" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.48"/>
            <DoubleAnimation Storyboard.TargetName="Dot8" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.56"/>
            <DoubleAnimation Storyboard.TargetName="Dot9" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.64"/>
            <DoubleAnimation Storyboard.TargetName="Dot10" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.72"/>
            <DoubleAnimation Storyboard.TargetName="Dot11" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.80"/>
            <DoubleAnimation Storyboard.TargetName="Dot12" Storyboard.TargetProperty="Opacity" From="0.2" To="1" Duration="0:0:0.2" BeginTime="0:0:0.88"/>
        </Storyboard>
    </Window.Resources>

    <!-- Тригер для запуску анімації -->
    <Window.Triggers>
        <EventTrigger RoutedEvent="FrameworkElement.Loaded">
            <BeginStoryboard Storyboard="{StaticResource DotsAnimation}"/>
        </EventTrigger>
    </Window.Triggers>

    <!-- Main container with glassmorphism effect -->
    <Border CornerRadius="16" Background="{StaticResource BackgroundGradient}">
        <Border.Effect>
            <DropShadowEffect BlurRadius="30" ShadowDepth="0" Color="Black" Opacity="0.3"/>
        </Border.Effect>

        <Grid Margin="32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Title with gradient text effect -->
            <StackPanel Grid.Row="0" HorizontalAlignment="Center" Margin="0,0,0,32">
                <TextBlock Text="Speed Test"
                           FontSize="32"
                           FontWeight="Light"
                           HorizontalAlignment="Center"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           Margin="0,0,0,4">
                    <TextBlock.Effect>
                        <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#6366F1" Opacity="0.3"/>
                    </TextBlock.Effect>
                </TextBlock>
                <TextBlock Text="IN PROGRESS"
                           FontSize="14"
                           FontWeight="Medium"
                           HorizontalAlignment="Center"
                           Foreground="{StaticResource AccentBrush}"
                           Opacity="0.8"/>
            </StackPanel>

            <!-- Advanced circular progress indicator -->
            <Grid Grid.Row="1" HorizontalAlignment="Center" Margin="0,0,0,32">
                <!-- Бігаючі крапки по колу -->
                <Canvas Width="120" Height="120" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <!-- 12 крапок по колу з іменами -->
                    <Ellipse x:Name="Dot1" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="0" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Ellipse x:Name="Dot2" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="30" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Ellipse x:Name="Dot3" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="60" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Ellipse x:Name="Dot4" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="90" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Ellipse x:Name="Dot5" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="120" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Ellipse x:Name="Dot6" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="150" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Ellipse x:Name="Dot7" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="180" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Ellipse x:Name="Dot8" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="210" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Ellipse x:Name="Dot9" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="240" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Ellipse x:Name="Dot10" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="270" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                    <Ellipse x:Name="Dot11" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="300" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        </Ellipse>
                    <Ellipse x:Name="Dot12" Width="14" Height="14" Fill="#00D4FF" Opacity="0.2">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="330" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        </Ellipse>
                </Canvas>
                <!-- Текст по центру кільця -->
                <TextBlock x:Name="CenterText"
                           Text="Connecting to server..." 
                           FontSize="11" 
                               FontWeight="Medium"
                           Foreground="#E6F6FF" 
                               HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           TextAlignment="Center"
                           Width="100"
                           Height="40"
                           TextWrapping="Wrap"
                           LineHeight="12"/>
                <!-- Статус, швидкість, сервер -->
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,140,0,0">
                    <TextBlock x:Name="StatusText" Text="" FontSize="14" FontWeight="Medium" Foreground="#B8BCC8" HorizontalAlignment="Center" Margin="0,4,0,0" Visibility="Collapsed"/>
                    <TextBlock x:Name="CurrentSpeedText" Text="" FontSize="22" FontWeight="Bold" Foreground="#00D4FF" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    <TextBlock x:Name="ServerNameText" Text="" FontSize="12" Foreground="#B8BCC8" HorizontalAlignment="Center" Opacity="0.8" Margin="0,4,0,0"/>
                </StackPanel>
            </Grid>

            <!-- Enhanced step indicators with labels -->
            <Grid Grid.Row="2" Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Step 1: Connect -->
                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <Border x:Name="Step1Indicator" Style="{StaticResource StepIndicator}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Connect" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,6,0,0"/>
                </StackPanel>

                <!-- Step 2: Latency -->
                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <Border x:Name="Step2Indicator" Style="{StaticResource StepIndicator}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Latency" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,6,0,0"/>
                </StackPanel>

                <!-- Step 3: Download -->
                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <Border x:Name="Step3Indicator" Style="{StaticResource StepIndicator}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Download" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,6,0,0"/>
                </StackPanel>

                <!-- Step 4: Upload -->
                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <Border x:Name="Step4Indicator" Style="{StaticResource StepIndicator}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Upload" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,6,0,0"/>
                </StackPanel>

                <!-- Progress line background -->
                <Rectangle Grid.ColumnSpan="4" Height="2" Fill="#2A2B35" 
                          VerticalAlignment="Center" Margin="32,0" RadiusX="1" RadiusY="1"/>

                <!-- Animated progress line -->
                <Rectangle x:Name="ProgressLine" Grid.ColumnSpan="4" Height="2" 
                          Fill="{StaticResource PrimaryGradient}" 
                          VerticalAlignment="Center" Margin="32,0" 
                          RadiusX="1" RadiusY="1"
                          HorizontalAlignment="Left" Width="0">
                    <Rectangle.Effect>
                        <DropShadowEffect BlurRadius="4" ShadowDepth="0" Color="#00D4FF" Opacity="0.6"/>
                    </Rectangle.Effect>
                </Rectangle>
            </Grid>

            <!-- Detail text with better typography -->
            <TextBlock Grid.Row="3" x:Name="DetailText"
                       Text="Initializing speed test..."
                       HorizontalAlignment="Center"
                       FontSize="14"
                       Foreground="{StaticResource TextSecondaryBrush}"
                       Margin="0,0,0,20"/>

            <!-- Enhanced CLI Output with glassmorphic design -->
            <Border Grid.Row="4"
                    CornerRadius="12"
                    Margin="0,0,0,24"
                    Background="#1A252631"
                    BorderBrush="#33FFFFFF"
                    BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Color="Black" Opacity="0.2"/>
                </Border.Effect>

                <Grid>
                    <!-- Header -->
                    <Border VerticalAlignment="Top" Height="40" 
                            Background="#1A6366F1" 
                            CornerRadius="12,12,0,0"
                            BorderBrush="#4D6366F1"
                            BorderThickness="0,0,0,1">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                            <Ellipse Width="8" Height="8" Fill="#FFFFFF" Margin="0,0,6,0"/>
                            <Ellipse Width="8" Height="8" Fill="#FFFFFF" Margin="0,0,6,0"/>
                            <Ellipse Width="8" Height="8" Fill="#FFFFFF" Margin="0,0,12,0"/>
                            <TextBlock Text="Terminal Output" FontSize="12" 
                                      Foreground="{StaticResource TextSecondaryBrush}" 
                                      VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Content -->
                    <ScrollViewer x:Name="OutputScrollViewer"
                                 VerticalScrollBarVisibility="Auto"
                                 HorizontalScrollBarVisibility="Auto"
                                 Padding="16"
                                 Margin="0,40,0,0">
                        <TextBlock x:Name="CLIOutputText"
                                   TextWrapping="NoWrap"
                                   FontFamily="JetBrains Mono, Consolas, Courier New"
                                   FontSize="11"
                                   Foreground="#22C55E"
                                   LineHeight="18"
                                   Background="Transparent"/>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Enhanced completion section -->
            <StackPanel Grid.Row="5" x:Name="CompletionSection" Visibility="Collapsed">
                <Border Background="#1A10B981" CornerRadius="8" Padding="16" Margin="0,0,0,8">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#10B981" Opacity="0.3"/>
                    </Border.Effect>
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock x:Name="CompletionTitleText"
                                   Text="✨ Test Complete!"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center"
                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                        <TextBlock x:Name="CompletionSubtitleText"
                                   Text="Your internet speed has been measured successfully"
                                   FontSize="12"
                                   HorizontalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>
    </Border>
</Window>