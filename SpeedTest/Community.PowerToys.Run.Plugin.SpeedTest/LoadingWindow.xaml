<Window
    x:Class="Community.PowerToys.Run.Plugin.SpeedTest.LoadingWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Speed Test in Progress"
    Height="560"
    Width="760"
    ResizeMode="NoResize"
    WindowStartupLocation="CenterScreen"
    Background="Transparent"
    AllowsTransparency="True"
    WindowStyle="None"
    Foreground="White"
    FontFamily="Segoe UI Variable Display">

        <Window.Resources>
            <!-- Enhanced modern color palette -->
            <SolidColorBrush x:Key="BackgroundBrush" Color="#0A0E1A" />
            <SolidColorBrush x:Key="CardBrush" Color="#1A1F2E" />
            <SolidColorBrush x:Key="GlassBrush" Color="#28FFFFFF" />
            <SolidColorBrush x:Key="TextPrimaryBrush" Color="#F8FAFC" />
            <SolidColorBrush x:Key="TextSecondaryBrush" Color="#CBD5E1" />
            <SolidColorBrush x:Key="TextTertiaryBrush" Color="#94A3B8" />
            <SolidColorBrush x:Key="AccentBrush" Color="#2563EB" />
            <SolidColorBrush x:Key="AccentGradientBrush" Color="#3B82F6" />
            <SolidColorBrush x:Key="SuccessBrush" Color="#059669" />
            <SolidColorBrush x:Key="WarningBrush" Color="#D97706" />
            <SolidColorBrush x:Key="ErrorBrush" Color="#DC2626" />

               <!-- Enhanced gradients -->
                <LinearGradientBrush x:Key="PrimaryGradient" StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#3B82F6" Offset="0"/>
                    <GradientStop Color="#2563EB" Offset="0.5"/>
                    <GradientStop Color="#1D4ED8" Offset="1"/>
                </LinearGradientBrush>

                <LinearGradientBrush x:Key="BackgroundGradient" StartPoint="0,0.2" EndPoint="1,0.8">
                    <GradientStop Color="#0A0E1A" Offset="0"/>
                    <GradientStop Color="#1A1F2E" Offset="0.4"/>
                    <GradientStop Color="#0F172A" Offset="1"/>
                </LinearGradientBrush>

                <LinearGradientBrush x:Key="GlassGradientBrush" StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#40FFFFFF" Offset="0"/>
                    <GradientStop Color="#10FFFFFF" Offset="1"/>
                </LinearGradientBrush>

                <RadialGradientBrush x:Key="AccentGlow" Center="0.5,0.5" RadiusX="1" RadiusY="1">
                    <GradientStop Color="#403B82F6" Offset="0"/>
                    <GradientStop Color="#203B82F6" Offset="0.7"/>
                    <GradientStop Color="#003B82F6" Offset="1"/>
                </RadialGradientBrush>

        <!-- Enhanced animations with smooth transitions -->
        <Storyboard x:Key="StepCompleteAnimation">
            <DoubleAnimation
                Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                From="1"
                To="1.15"
                Duration="0:0:0.3"
                AutoReverse="True">
                <DoubleAnimation.EasingFunction>
                    <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation
                Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                From="1"
                To="1.15"
                Duration="0:0:0.3"
                AutoReverse="True">
                <DoubleAnimation.EasingFunction>
                    <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Fade in animation for elements -->
        <Storyboard x:Key="FadeInAnimation">
            <DoubleAnimation
                Storyboard.TargetProperty="Opacity"
                From="0"
                To="1"
                Duration="0:0:0.5">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Progress line animation -->
        <Storyboard x:Key="ProgressLineAnimation">
            <DoubleAnimation
                Storyboard.TargetProperty="Width"
                Duration="0:0:0.8">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseInOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Step indicator styles with modern design -->
        <Style x:Key="StepIndicator" TargetType="Border">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="Margin" Value="8,0"/>
            <Setter Property="Background" Value="#2A2B35"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="BorderBrush" Value="#3A3B45"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform/>
                </Setter.Value>
            </Setter>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
        </Style>

        <Style x:Key="ActiveStepIndicator" TargetType="Border" BasedOn="{StaticResource StepIndicator}">
            <Setter Property="Background" Value="{StaticResource PrimaryGradient}"/>
                    <Setter Property="BorderBrush" Value="#3B82F6"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#3B82F6" Opacity="0.5"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CompletedStepIndicator" TargetType="Border" BasedOn="{StaticResource StepIndicator}">
            <Setter Property="Background" Value="#10B981"/>
            <Setter Property="BorderBrush" Value="#059669"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="6" ShadowDepth="0" Color="#10B981" Opacity="0.4"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ErrorStepIndicator" TargetType="Border" BasedOn="{StaticResource StepIndicator}">
            <Setter Property="Background" Value="#EF4444"/>
            <Setter Property="BorderBrush" Value="#DC2626"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="6" ShadowDepth="0" Color="#EF4444" Opacity="0.4"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Fixed working dots animation -->
        <Storyboard x:Key="DotsAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="Dot1" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:0"/>
            <DoubleAnimation Storyboard.TargetName="Dot1" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:0.1"/>

            <DoubleAnimation Storyboard.TargetName="Dot2" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:0.1"/>
            <DoubleAnimation Storyboard.TargetName="Dot2" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:0.2"/>

            <DoubleAnimation Storyboard.TargetName="Dot3" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:0.2"/>
            <DoubleAnimation Storyboard.TargetName="Dot3" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:0.3"/>

            <DoubleAnimation Storyboard.TargetName="Dot4" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:0.3"/>
            <DoubleAnimation Storyboard.TargetName="Dot4" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:0.4"/>

            <DoubleAnimation Storyboard.TargetName="Dot5" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:0.4"/>
            <DoubleAnimation Storyboard.TargetName="Dot5" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:0.5"/>

            <DoubleAnimation Storyboard.TargetName="Dot6" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:0.5"/>
            <DoubleAnimation Storyboard.TargetName="Dot6" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:0.6"/>

            <DoubleAnimation Storyboard.TargetName="Dot7" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:0.6"/>
            <DoubleAnimation Storyboard.TargetName="Dot7" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:0.7"/>

            <DoubleAnimation Storyboard.TargetName="Dot8" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:0.7"/>
            <DoubleAnimation Storyboard.TargetName="Dot8" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:0.8"/>

            <DoubleAnimation Storyboard.TargetName="Dot9" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:0.8"/>
            <DoubleAnimation Storyboard.TargetName="Dot9" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:0.9"/>

            <DoubleAnimation Storyboard.TargetName="Dot10" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:0.9"/>
            <DoubleAnimation Storyboard.TargetName="Dot10" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:1.0"/>

            <DoubleAnimation Storyboard.TargetName="Dot11" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:1.0"/>
            <DoubleAnimation Storyboard.TargetName="Dot11" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:1.1"/>

            <DoubleAnimation Storyboard.TargetName="Dot12" Storyboard.TargetProperty="Opacity" From="0.3" To="1" Duration="0:0:0.1" BeginTime="0:0:1.1"/>
            <DoubleAnimation Storyboard.TargetName="Dot12" Storyboard.TargetProperty="Opacity" From="1" To="0.3" Duration="0:0:0.1" BeginTime="0:0:1.2"/>
        </Storyboard>
    </Window.Resources>

    <!-- Enhanced window triggers -->
    <Window.Triggers>
        <EventTrigger RoutedEvent="FrameworkElement.Loaded">
            <BeginStoryboard Storyboard="{StaticResource DotsAnimation}"/>
        </EventTrigger>
    </Window.Triggers>

    <!-- Enhanced main container with advanced glassmorphism -->
    <Border CornerRadius="20" Background="{StaticResource BackgroundGradient}">
        <Border.Effect>
            <DropShadowEffect BlurRadius="40" ShadowDepth="2" Color="Black" Opacity="0.25"/>
        </Border.Effect>
        <Border.OpacityMask>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="White" Offset="0"/>
                <GradientStop Color="#F0FFFFFF" Offset="0.3"/>
                <GradientStop Color="White" Offset="1"/>
            </LinearGradientBrush>
        </Border.OpacityMask>

        <Grid Margin="32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Enhanced title with modern typography -->
            <StackPanel Grid.Row="0" HorizontalAlignment="Center" Margin="0,0,0,40">
                <TextBlock Text="Speed Test"
                           FontSize="36"
                           FontWeight="SemiBold"
                           HorizontalAlignment="Center"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           Margin="0,0,0,8">
                    <TextBlock.Effect>
                       <DropShadowEffect BlurRadius="12" ShadowDepth="0" Color="#2563EB" Opacity="0.3"/>
                    </TextBlock.Effect>
                </TextBlock>
                <Border Background="{StaticResource AccentGradientBrush}" 
                        CornerRadius="12" 
                        Padding="12,4" 
                        HorizontalAlignment="Center"
                        Opacity="0.9">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.4"/>
                    </Border.Effect>
                    <TextBlock Text="RUNNING"
                               FontSize="11"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               Foreground="White"/>
                </Border>
            </StackPanel>

            <!-- Enhanced circular progress indicator -->
            <Grid Grid.Row="1" HorizontalAlignment="Center" Margin="0,0,0,40">
                <!-- Outer glow ring -->
                <Ellipse Width="140" Height="140" 
                         Fill="{StaticResource AccentGlow}" 
                         Opacity="0.3"
                         HorizontalAlignment="Center" 
                         VerticalAlignment="Center"/>

                <!-- Running dots circle -->
                <Canvas Width="120" Height="120" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <!-- 12 animated dots with glow effects -->
                        <Ellipse x:Name="Dot1" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="0" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                    </Ellipse>
                        <Ellipse x:Name="Dot2" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="30" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                    </Ellipse>
                       <Ellipse x:Name="Dot3" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="60" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                    </Ellipse>
                        <Ellipse x:Name="Dot4" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="90" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                    </Ellipse>
                        <Ellipse x:Name="Dot5" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="120" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                    </Ellipse>
                        <Ellipse x:Name="Dot6" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="150" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                    </Ellipse>
                        <Ellipse x:Name="Dot7" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="180" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                    </Ellipse>
                        <Ellipse x:Name="Dot8" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="210" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                    </Ellipse>
                        <Ellipse x:Name="Dot9" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="240" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                    </Ellipse>
                        <Ellipse x:Name="Dot10" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="270" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                    </Ellipse>
                        <Ellipse x:Name="Dot11" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="300" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                        </Ellipse>
                        <Ellipse x:Name="Dot12" Width="14" Height="14" Fill="{StaticResource AccentBrush}" Opacity="0.3">
                        <Ellipse.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="330" CenterX="60" CenterY="60"/>
                                <TranslateTransform X="0" Y="-48"/>
                            </TransformGroup>
                        </Ellipse.RenderTransform>
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.9"/>
                        </Ellipse.Effect>
                        </Ellipse>
                </Canvas>
                <!-- Enhanced center text -->
                <Border Background="{StaticResource GlassGradientBrush}" 
                        CornerRadius="8" 
                        Padding="8,6" 
                        HorizontalAlignment="Center" 
                        VerticalAlignment="Center"
                        BorderBrush="#20FFFFFF"
                        BorderThickness="1">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="4" ShadowDepth="0" Color="Black" Opacity="0.2"/>
                    </Border.Effect>
                    <TextBlock x:Name="CenterText"
                               Text="Connecting to server..." 
                               FontSize="10" 
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}" 
                               TextAlignment="Center"
                               Width="90"
                               TextWrapping="Wrap"
                               LineHeight="14"/>
                </Border>
                <!-- Enhanced status display -->
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,150,0,0">
                    <TextBlock x:Name="StatusText" 
                               Text="" 
                               FontSize="13" 
                               FontWeight="Medium" 
                               Foreground="{StaticResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" 
                               Margin="0,6,0,0" 
                               Visibility="Collapsed"/>
                    <TextBlock x:Name="CurrentSpeedText" 
                               Text="" 
                               FontSize="24" 
                               FontWeight="Bold" 
                               Foreground="{StaticResource AccentBrush}" 
                               HorizontalAlignment="Center" 
                               Margin="0,6,0,0">
                        <TextBlock.Effect>
                            <DropShadowEffect BlurRadius="6" ShadowDepth="0" Color="#2563EB" Opacity="0.4"/>
                        </TextBlock.Effect>
                    </TextBlock>
                    <Border Background="{StaticResource GlassGradientBrush}" 
                            CornerRadius="6" 
                            Padding="6,2" 
                            HorizontalAlignment="Center" 
                            Margin="0,4,0,0"
                            BorderBrush="#15FFFFFF"
                            BorderThickness="1">
                        <TextBlock x:Name="ServerNameText" 
                                   Text="" 
                                   FontSize="11" 
                                   Foreground="{StaticResource TextTertiaryBrush}" 
                                   HorizontalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </Grid>

            <!-- Enhanced step indicators with labels -->
            <Grid Grid.Row="2" Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Step 1: Connect -->
                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                    <Border x:Name="Step1Indicator" Style="{StaticResource StepIndicator}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Connect" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,6,0,0"/>
                </StackPanel>

                <!-- Step 2: Latency -->
                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <Border x:Name="Step2Indicator" Style="{StaticResource StepIndicator}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Latency" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,6,0,0"/>
                </StackPanel>

                <!-- Step 3: Download -->
                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                    <Border x:Name="Step3Indicator" Style="{StaticResource StepIndicator}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Download" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,6,0,0"/>
                </StackPanel>

                <!-- Step 4: Upload -->
                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                    <Border x:Name="Step4Indicator" Style="{StaticResource StepIndicator}" HorizontalAlignment="Center"/>
                    <TextBlock Text="Upload" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" 
                               HorizontalAlignment="Center" Margin="0,6,0,0"/>
                </StackPanel>

                <!-- Enhanced progress line background -->
                <Rectangle Grid.ColumnSpan="4" Height="3" Fill="#1E293B" 
                          VerticalAlignment="Center" Margin="32,0" RadiusX="2" RadiusY="2"/>

                <!-- Enhanced animated progress line -->
                <Rectangle x:Name="ProgressLine" Grid.ColumnSpan="4" Height="3" 
                          Fill="{StaticResource PrimaryGradient}" 
                          VerticalAlignment="Center" Margin="32,0" 
                          RadiusX="2" RadiusY="2"
                          HorizontalAlignment="Left" Width="0">
                    <Rectangle.Effect>
                        <DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#2563EB" Opacity="0.7"/>
                    </Rectangle.Effect>
                    <Rectangle.RenderTransform>
                        <TranslateTransform/>
                    </Rectangle.RenderTransform>
                </Rectangle>
            </Grid>

            <!-- Enhanced detail text -->
            <Border Grid.Row="3" 
                    Background="{StaticResource GlassGradientBrush}" 
                    CornerRadius="10" 
                    Padding="16,8" 
                    HorizontalAlignment="Center" 
                    Margin="0,0,0,24"
                    BorderBrush="#20FFFFFF"
                    BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="6" ShadowDepth="0" Color="Black" Opacity="0.1"/>
                </Border.Effect>
                <TextBlock x:Name="DetailText"
                           Text="Initializing speed test..."
                           HorizontalAlignment="Center"
                           FontSize="13"
                           FontWeight="Medium"
                           Foreground="{StaticResource TextSecondaryBrush}"/>
            </Border>

            <!-- Premium terminal output with modern styling -->
            <Border Grid.Row="4"
                    CornerRadius="16"
                    Margin="0,0,0,28"
                    Background="{StaticResource GlassGradientBrush}"
                    BorderBrush="#40FFFFFF"
                    BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="24" ShadowDepth="0" Color="Black" Opacity="0.15"/>
                </Border.Effect>
                <Border.OpacityMask>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#F0FFFFFF" Offset="0"/>
                        <GradientStop Color="White" Offset="0.5"/>
                        <GradientStop Color="#F0FFFFFF" Offset="1"/>
                    </LinearGradientBrush>
                </Border.OpacityMask>

                <Grid>
                    <!-- Enhanced header -->
                    <Border VerticalAlignment="Top" Height="44"
                        Background="{StaticResource PrimaryGradient}"
                        CornerRadius="16,16,0,0"
                        BorderBrush="#502563EB"
                        BorderThickness="0,0,0,1">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="6" ShadowDepth="0" Color="#2563EB" Opacity="0.3"/>
                        </Border.Effect>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0">
                            <Ellipse Width="10" Height="10" Fill="#FF5F57" Margin="0,0,8,0">
                                <Ellipse.Effect>
                                    <DropShadowEffect BlurRadius="2" ShadowDepth="0" Color="#FF5F57" Opacity="0.5"/>
                                </Ellipse.Effect>
                            </Ellipse>
                            <Ellipse Width="10" Height="10" Fill="#FFBD2E" Margin="0,0,8,0">
                                <Ellipse.Effect>
                                    <DropShadowEffect BlurRadius="2" ShadowDepth="0" Color="#FFBD2E" Opacity="0.5"/>
                                </Ellipse.Effect>
                            </Ellipse>
                            <Ellipse Width="10" Height="10" Fill="#28CA42" Margin="0,0,16,0">
                                <Ellipse.Effect>
                                    <DropShadowEffect BlurRadius="2" ShadowDepth="0" Color="#28CA42" Opacity="0.5"/>
                                </Ellipse.Effect>
                            </Ellipse>
                            <TextBlock Text="Terminal Output" 
                                      FontSize="13" 
                                      FontWeight="SemiBold"
                                      Foreground="White" 
                                      VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Enhanced content area -->
                    <ScrollViewer x:Name="OutputScrollViewer"
                                 VerticalScrollBarVisibility="Auto"
                                 HorizontalScrollBarVisibility="Auto"
                                 Padding="20"
                                 Margin="0,44,0,0"
                                 Background="#0A0F172A">
                        <TextBlock x:Name="CLIOutputText"
                                   TextWrapping="NoWrap"
                                   FontFamily="JetBrains Mono, SF Mono, Consolas, Monaco"
                                   FontSize="11"
                                   Foreground="#10B981"
                                   LineHeight="20"
                                   Background="Transparent">
                            <TextBlock.Effect>
                                <DropShadowEffect BlurRadius="2" ShadowDepth="0" Color="#10B981" Opacity="0.3"/>
                            </TextBlock.Effect>
                        </TextBlock>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Premium completion section -->
            <StackPanel Grid.Row="5" x:Name="CompletionSection" Visibility="Collapsed">
                <Border CornerRadius="16" 
                        Padding="24" 
                        Margin="0,0,0,8"
                        BorderBrush="#4010B981"
                        BorderThickness="2">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="16" ShadowDepth="0" Color="#059669" Opacity="0.25"/>
                    </Border.Effect>
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#20059669" Offset="0"/>
                            <GradientStop Color="#1010B981" Offset="0.5"/>
                            <GradientStop Color="#20059669" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <StackPanel HorizontalAlignment="Center">
                        <Border Background="{StaticResource SuccessBrush}" 
                                CornerRadius="20" 
                                Width="40" 
                                Height="40" 
                                HorizontalAlignment="Center" 
                                Margin="0,0,0,16">
                            <Border.Effect><DropShadowEffect BlurRadius="8" ShadowDepth="0" Color="#059669" Opacity="0.5"/>
                            </Border.Effect>
                            <TextBlock Text="✓" 
                                      FontSize="20" 
                                      FontWeight="Bold" 
                                      Foreground="White" 
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock x:Name="CompletionTitleText"
                                   Text="Test Complete!"
                                   FontSize="22"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Center"
                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                        <TextBlock x:Name="CompletionSubtitleText"
                                   Text="Your internet speed has been measured successfully"
                                   FontSize="13"
                                   HorizontalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,6,0,0"
                                   TextAlignment="Center"
                                   MaxWidth="300"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>
    </Border>
</Window>